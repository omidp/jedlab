<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" template="/layout/layout.xhtml">

	<ui:define name="head">
		<script type="text/javascript" src="#{_ctx}/js/materialize.js"> </script>
		<link href="#{_ctx}/css/materialize.css" rel="stylesheet" />
	</ui:define>

	<ui:define name="body">

		<div class="ui two column middle aligned very relaxed stackable grid w3-margin">

				<div class="center aligned column locale-dir"
					id="profilePanel">

					<h3 class="ui block header">#{messages['Profile_Information']}</h3>
					<div class="ui borderless segment">
						<div class="ui top right attached label">
							<h:outputText value="#{jedLab.currentUser.username}" />
						</div>
						<div class="avatar-wrapper">
							<div class="avatar"></div>
						</div>

						<h:form id="profileForm" styleClass="ui large form"
							style="margin-top:12px;">

							<s:decorate id="emailField" template="/layout/edit.xhtml">
								<h:inputText value="#{userHome.user.email}" required="true" />
								<ui:define name="label">
									#{messages['Email']}
								</ui:define>
							</s:decorate>


							<div class="actionButtons">
								<h:commandButton action="#{userHome.update()}"
									value="#{messages['Update']}" id="btnUpdate"
									styleClass="btn btn-blue">
								</h:commandButton>
							</div>
						</h:form>

					</div>
				</div>

				<div class="ui vertical divider"></div>
				
				<div class="center aligned column locale-dir"
					id="changePasswordPanel">

					<h3 class="ui block header">#{messages['Change_Password']}</h3>
					<div class="ui borderless segment">


						<s:decorate id="currentPassField" template="/layout/edit.xhtml">
							<h:inputSecret id="currentPassInp" required="true" />
							<ui:define name="label">
								#{messages['Current_Password']}
							</ui:define>
						</s:decorate>

						<s:decorate id="NewPassField" template="/layout/edit.xhtml">
							<h:inputSecret id="passInp" required="true" />
							<ui:define name="label">
								#{messages['New_Password']}
							</ui:define>
						</s:decorate>

						<s:decorate id="RptNewPassField" template="/layout/edit.xhtml">
							<h:inputSecret id="confirmPassInp" required="true" />
							<ui:define name="label">
								#{messages['Repeat']} #{' '} #{messages['New_Password']}
							</ui:define>
						</s:decorate>

						<h:form id="changePasswdForm">
							<h:inputHidden value="#{changePasswordAction.currentPassword}"
								id="currentPass" required="true" />
							<h:inputHidden value="#{changePasswordAction.password}" id="pass"
								required="true" />
							<h:inputHidden value="#{changePasswordAction.confirmPassword}"
								id="confirmPass" required="true" />
							<div class="actionButtons">
								<h:commandButton
									action="#{changePasswordAction.changePassword()}"
									value="#{messages['Change_Password']}" id="btnChangePass"
									styleClass="btn btn-blue">
								</h:commandButton>
							</div>
						</h:form>

					</div>

			</div>
		</div>
		<script>
		//<![CDATA[
			jQuery(document).ready(function(){
				
				jQuery("#changePasswordPanel").find(":input[type='password']").on('focus', function(){					
					jQuery(this).on('keypress', function(e){									
						if (e.keyCode == 13) { 
								jQuery("#changePasswdForm\\:btnChangePass").click();	
						 } else return true;

						});
				});
				jQuery("#profilePanel").find(":input[type='text']").on('focus', function(){					
					document.forms['profileForm'].onkeypress = new Function("event", "{var keycode;if (window.event) keycode = window.event.keyCode;else if (event) keycode = event.which;else return true;if (keycode == 13) { document.getElementById('profileForm:btnUpdate').click();return false; } else return true; }");
				});
				jQuery("#changePasswdForm\\:btnChangePass").click(function(e){					
					var v = isChangePassValid();
					if(!v)
					{
						e.preventDefault();
					}
					else
					{
						jQuery("#changePasswdForm\\:currentPass").val(btoa(jQuery("#currentPassField\\:currentPassInp").val()));
						jQuery("#changePasswdForm\\:pass").val(btoa(jQuery("#NewPassField\\:passInp").val()));
						jQuery("#changePasswdForm\\:confirmPass").val(btoa(jQuery("#RptNewPassField\\:confirmPassInp").val()));
						
					}
				});
			});
			function isChangePassValid()
			{
				var valid = true;
				jQuery("#changePasswordPanel").find(":input[type='password']").each(function(){
					var _self = jQuery(this);
					if(_self.val() == '')
					{
						_self.addClass("required");
						setTimeout(function(){_self.removeClass("required");}, 500);
						valid = false;						
					}
				});
				return valid;
				
			}
			//]]>
		</script>

		<script>
		jQuery(document).ready(function(){
			Materialize.updateTextFields();
		});
	</script>


	</ui:define>
</ui:composition>
