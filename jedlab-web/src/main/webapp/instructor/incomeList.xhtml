<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:jedlab="http://tasktops.com/ui"
	xmlns:h="http://java.sun.com/jsf/html" template="/layout/layout.xhtml">

	<ui:define name="head">
		
		<style>
			
		</style>
	</ui:define>

	<ui:define name="body">
	
		<s:fragment rendered="#{not empty incomeQuery.resultList}">
		<div class="w3-margin">
			<h:form id="searchIncomeForm">
				<fieldset>
					<legend>#{messages['Search']}</legend>
					
					<s:decorate template="/layout/display.xhtml">
						<ui:define name="label">#{messages['Course']}</ui:define>
						<jedlab:suggestion placeholder="#{messages['Search']} #{messages['Course']}"
						url="#{_ctx}/course.search" onSelect="redirectToIncomeList"
						value="#{incomeQuery.course.name}" forceId="instructorSearchCourseName"
						styleClass="prompt"></jedlab:suggestion>
					</s:decorate>
					
					<h:inputHidden value="#{incomeQuery.course.name}" id="instructorSearchCourseName" />
					<h:commandButton action="#{incomeQuery.redirectIt()}" value="Search" style="display:none;" id="btnSearch"/>
					
					<script>
					jQuery(document).keypress(
						    function(event){
						     if (event.which == '13') {
						        event.preventDefault();
						      }
						});
						function redirectToIncomeList(event, ui)
						{
							location.href = window.location.origin + '#{_ctx}/instructor/incomeList/'+ui.item.id;
						}
						jQuery(document).ready(function(){
							jQuery("#instructorSearchCourseName").on('keyup', function(e){
								if (e.keyCode == 13) {
									var v = jQuery(this).val();
									console.log(v);
									jQuery("#searchIncomeForm\\:instructorSearchCourseName").val(v); 
									jQuery("#searchIncomeForm\\:btnSearch").click();
								}
							});
						});
					</script>
					 
				</fieldset>
			</h:form>
		
			<fieldset>
				<legend>#{messages['Statistics']}</legend>
				
				<h:panelGrid columns="2" dir="rtl">
					 
					<h:outputText value="#{messages['Total_Income']} : " />
					<h:panelGroup layout="block">
						<h:outputText value="#{incomeQuery.totalIncome}" converter="#{bigDecimalConverter}" /> 
						<h:outputText value="#{messages['Toman']}" />
					</h:panelGroup> 
				
				</h:panelGrid>
				 
			</fieldset>
			
			
			<table class="ui table" dir="rtl">
				<thead>
					<tr>
						<th>#{messages['Description']}</th>
						<th>#{messages['Amount']} (#{messages['Toman']})</th>
						<th>#{messages['User_Name']}</th>
						<th>#{messages['Date']}</th>
						<th>
						<s:decorate template="/layout/sort.xhtml">
									<ui:param name="entityList" value="#{incomeQuery}" />
									<ui:param name="propertyLabel" value="#{messages['Payment_Status']}" />
									<ui:param name="propertyPath" value="i.paid" />
						</s:decorate>
						</th>
					</tr>
				</thead>
				<tbody>
					<c:forEach items="#{incomeQuery.resultList}" var="_item">
						<tr>
							<td>
								<h4 class="ui header">  
									<h:outputText value="#{_item.description}" rendered="#{not empty _item.description}" />
									<h:outputText value="#{_item.course.name}" rendered="#{empty _item.description}" />
								</h4>
							</td>
							<td><h:outputText value="#{_item.paymentAmount}"
									converter="#{bigDecimalConverter}" /></td>
							<td> <h:outputText value="#{_item.member.username}" /> </td>
							<td><h:outputText value="#{_item.createdDate}"
									converter="#{persianDateConverter}" /></td>
							<td>
								<s:span rendered="#{_item.paid}" styleClass="icon-checkmark" style="color:#38CC33"></s:span>
								<s:span rendered="#{!_item.paid}" styleClass="icon-cross" style="color:#F90925"></s:span>
							</td>		
						</tr>
					</c:forEach>
	
				</tbody>
			</table>
		  
		</div>
		
		<s:decorate template="/layout/seamPaging.xhtml">
			<ui:param name="entityList" value="#{incomeQuery}" />
		</s:decorate>
		
		</s:fragment>
		
		<s:fragment rendered="#{empty incomeQuery.resultList}">
			<div class="ui container">
			<div
				class="ui middle aligned equal width center aligned padded grid w3-margin">

				<div class="row centerContent">


					<div class="column">
						<div class="ui piled segment" id="content">
							<h1 class="title">هیچکس در دوره ی 
							<h:outputText value="#{incomeQuery.course.name}" rendered="#{not empty incomeQuery.course.name}" />
							شما ثبت نام نکرده</h1>
							
							<p>
								
							</p>
						</div>

					</div>

				</div>
			</div>
		</div>
		</s:fragment>
		

	</ui:define>
</ui:composition>
