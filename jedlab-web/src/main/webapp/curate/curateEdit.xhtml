<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html" template="/layout/layout.xhtml">

	
	<ui:define name="head">
		<script type="text/javascript" src="#{_ctx}/js/handlebars.runtime-v4.0.5.js"></script>
		<script type="text/javascript" src="#{_ctx}/js/templates/templates.js"></script>
		<style type="text/css">
			label:hover {
			    background: #f2f5ff;
			    border-radius:5px;
			    padding:2px 4px;
			}
		</style>
	
	</ui:define>
	
	<ui:define name="body">
		<input type="hidden" id="pageId" value="#{pageId}"/>
		<div style="margin-top: 20px; margin-right: 10px"
		class="locale-direction">
			
			<div>
					<button 
						class="w3-btn w3-large w3-circle w3-xlarge w3-ripple w3-teal w3-right" 
						id="createCurateBlockBtn"
					>+</button>

				<script type="text/javascript">
					jQuery(window).load(function(){
						jQuery("#createCurateBlockBtn").popup({ content : "#{messages['Create_Block']}" });
					});

					jQuery(document).ready(function(){

						jQuery("#createCurateBlockBtn").click(function(){

							var pageId = jQuery("#pageId").val();
							jQuery.ajax(
									{
										type:"POST",
										url: "#{_ctx}/seam/resource/api/pages/blocks",
										data: JSON.stringify({ 'id': pageId }),
										contentType: "application/json; charset=utf-8",
										dataType: "json",
										success: function(data){																				
											var template = Handlebars.templates['pageBlocks'];
											var html  = template(data);											
											jQuery("#page_blocks").append(html);
											curate.setUpClickEdit(data.id);
																				
										},
										failure: function(errMsg) {
											common.notification("#{messages['Error_Title']}", "errormsg");
									    }
									}
								);

						});

							
					});

					
					
				</script>
			</div>
			
			
			<div class="ui two cards" id="page_blocks">
			
				<c:forEach var="_item" items="#{pageHome.instance.blocks}">
  
				  <div class="card" id="block_#{_item.id}">
				    <div class="content">
				      <div class="left floated meta">				      	
				      </div>
				      <label class="pull-left" data-block-id="#{_item.id}" data-block-title="#{_item.title}">#{_item.title}</label>
					  <input class="clickedit #{_item.id}" type="text" value="#{_item.title}"/>					  
				    </div> 
				    <div class="content">
				    	<div class="ui ordered divided list" style="direction:ltr;" id="ul_#{_item.id}">
							<c:forEach var="_curate" items="#{_item.curates}">
									<a class="item" href="#{_curate.url}" target="_blank" data-curate-id="#{_curate.id}">#{_curate.titleOrUrl}</a>
							</c:forEach>
						</div>						
				    </div>
				    <div class="extra content">
				    	<div class="ui action input">
						  <input placeholder="#{messages['URL']}" type="text" id="curinp_#{_item.id}"/>
						  <button class="ui icon button addcur" id="curbtn_#{_item.id}" data-block-id="#{_item.id}" onclick="curate.addCurate(#{_item.id})"> 
						    <i class="icon-plus"></i>
						  </button>
						</div>
				    </div>
				  </div>
				  
				</c:forEach>  
		    
 		   </div>
			
			
	</div>
	
	
	
	<script>
	//<![CDATA[
	var defaultText = 'Click me and enter some text';

	jQuery(document).ready(function(){

		curate.setUpClickEdit();
		
	});
	
	//]]>
	</script>
	
	
	<script type="text/javascript" src="#{_ctx}/js/curate.js"></script>
	

	</ui:define>
</ui:composition>
