<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:jedlab="http://tasktops.com/ui">

	<div class="panel panel-default">
		<div class="panel-body">
			<div class="ui divided items locale-direction">
				<div class="item">
					<div class="image">
						<s:graphicImage value="#{courseHome.instance.image}"
							style="height:150px;" rendered="#{courseHome.instance.hasImage}">
							<s:transformImageSize maintainRatio="true" height="150"></s:transformImageSize>
						</s:graphicImage>

						<s:graphicImage value="/images/no_video_photo.png"
							style="height:150px;"
							rendered="#{courseHome.instance.hasImage == false}">
							<s:transformImageSize maintainRatio="true" height="150"></s:transformImageSize>
						</s:graphicImage>
					</div>
					<div class="content">
						<a class="header">#{courseHome.instance.name}</a>
						<div class="meta">
							<span class="cinema"> <h:outputText
									value="#{courseHome.instance.chapters.size()} #{messages['Chapter']}" />
							</span>
						</div>
						<div class="description">
							<p>
								#{messages['Publish_Date']} :
								<h:outputText value="#{courseHome.instance.createdDate}"
									converter="#{persianDateConverter}" />
								<br /> #{messages['Level']} :
								<h:outputText value="#{courseHome.instance.level.label}" />
								<br />
								<h:outputText value="#{messages['Free']}"
									rendered="#{courseHome.instance.free}" />
								<s:fragment rendered="#{!courseHome.instance.free}">
										<h:outputText value="#{courseHome.instance.price}"  converter="#{bigDecimalConverter}">
										</h:outputText>
										<h:outputText value="#{messages['Toman']}" />
								</s:fragment>
							</p>
						</div>
						<div class="extra">
							<s:fragment rendered="#{identity.loggedIn}">
								<script>
								var ratingDisabled = false;
								jQuery(document).ready(function(){
									 jQuery('#courseRating').rating('setting', 'onRate', function(value) {
										 if(ratingDisabled)
											 return false;								      
										 var jqxhr = jQuery.post( "#{_ctx}/rating",{rate: value, courseId:"#{courseHome.instance.id}"}, function() {
											 common.notification("#{messages['Comment_created']}", "infomsg");
									    	})
									    	  .done(function(x, v, s) {
									    		  ratingDisabled = true;	  
									    		  jQuery('#courseRating').rating('set rating', x);
									    		  ratingDisabled = false;	 	
									    		  //common.notification("#{messages['Comment_created']}", "infomsg");					    	    
									    	  })
									    	  .fail(function() {
									    	    
									    	  });	      
									  });									 
								});
								</script>
							</s:fragment>
							<s:fragment rendered="#{!identity.loggedIn}">
								<script>
								jQuery(document).ready(function(){
									jQuery('#courseRating').rating('disable');
								});
								</script>
							</s:fragment>
							
							<div class="ui star rating" data-rating="#{courseHome.rating}" data-max-rating="5" id="courseRating"></div>
							<br />
							<s:div styleClass="ui label" rendered="#{identity.loggedIn and !courseHome.instance.registered}">
								<s:button value="#{messages['Enroll_To_View']}"
									propagation="none" type="button" includePageParams="false"
									action="#{courseHome.register()}"
									onclick="common.showLoading();"
									rendered="#{identity.loggedIn and !courseHome.instance.registered and s:hasRole('Student')}"
									styleClass="btn btn-green locale-font">
									<f:param name="courseId" value="#{courseId}"></f:param>
								</s:button>
								
							</s:div>
							
							<s:div styleClass="ui label" rendered="#{!identity.loggedIn}">
							
								<button type="button" class="btn btn-yellow locale-font"
										onclick="redirectToLogin();" style="cursor: pointer;">#{messages['Login_To_View']}</button>
							
							</s:div>
							
							<s:fragment rendered="#{identity.loggedIn and courseHome.instance.registered and courseHome.instance.free}">
								<button type="button"
									onclick="redirectToPaymentGateway();"																												
									class="btn btn-green locale-font">
									<h:outputText value="#{messages['Get_Download_Link']} #{courseHome.instance.downloadPrice} #{messages['Toman']}" />									
								</button>
								<br />
							</s:fragment>	
							<s:fragment rendered="#{identity.loggedIn and courseHome.instance.registered}">
								
								
								<c:forEach items="#{courseHome.instance.tags}" var="_tag">
								
									<s:div styleClass="ui label">
										<h:outputText value="#{_tag.name}" />
									</s:div>
									
								</c:forEach> 
							
							</s:fragment>
							
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div style="padding: 5px; margin: 5px;margin-bottom: 65px;">

		<jedlab:tabs scrollWidth="100%" keepState="true">

			<jedlab:tabPanel title="#{messages['Preview']}" 
				rendered="#{not empty courseHome.preview.id}"
				join="false" includePageParams="false"
				useIframe="true"
				link="#{_ctx}/videoPreview.seam?prevId=#{courseHome.preview.id}">
				
			</jedlab:tabPanel>
			
			<jedlab:tabPanel title="#{messages['Chapter_List']}">
				<ui:include src="/WEB-INF/inc/chapterList.xhtml" />
			</jedlab:tabPanel>
			

			<jedlab:tabPanel title="#{messages['Detail']}">
				<ui:include src="/WEB-INF/inc/courseDetail.xhtml" />
			</jedlab:tabPanel>

			

			<jedlab:tabPanel title="#{messages['Comment']} ( #{commentQuery.resultCount} )" useIframe="true"
				join="false" includePageParams="false"
				link="#{_ctx}/comment.seam?courseId=#{courseId}">

			</jedlab:tabPanel>

		</jedlab:tabs>

	</div>
	

	

	<script>
	function redirectToLogin()
	{
		window.top.location.href = window.location.origin +"#{_ctx}/member/course.seam?courseId=#{courseId}"; 
	}
	function redirectToPaymentGateway()
	{
		common.showLoading();
		window.top.location.href = window.location.origin +"#{_ctx}/payment.seam?courseId=#{courseId}"; 
	}
	</script>

</ui:composition>
