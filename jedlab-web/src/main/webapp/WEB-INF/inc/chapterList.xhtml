<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core">

	<s:fragment rendered="#{s:hasRole('Admin')}">
		<h:dataTable value="#{chapterQuery.resultList}" var="_item"
			styleClass="ui selectable celled table" dir="rtl">

			<h:column>
				<s:link value="#{_item.name}" view="/admin/chapterEdit.xhtml"
					propagation="none" includePageParams="false">
					<f:param name="chapterId" value="#{_item.id}"></f:param>
					<f:param name="courseId" value="#{_item.course.id}"></f:param>
				</s:link>
			</h:column>

		</h:dataTable>

		<s:decorate template="/layout/seamPaging.xhtml">
			<ui:param name="entityList" value="#{chapterQuery}" />
		</s:decorate>
	</s:fragment>

	<!-- User Area -->
	<s:fragment rendered="#{not s:hasRole('Admin')}">

		<s:button value="#{messages['Enroll_To_View']}" propagation="none"
			type="button" includePageParams="false"
			action="#{courseHome.register()}"
			rendered="#{identity.loggedIn and !courseHome.instance.registered}"
			styleClass="btn btn-yellow">
			<f:param name="courseId" value="#{courseId}"></f:param>
		</s:button>

		<table class="ui selectable celled table" dir="rtl">
			<thead>
				<tr>
					<th>#{messages['Chapter_Name']}</th>
					<th>#{messages['Duration']}</th>
					<th>#{messages['Publish_Date']}</th>
					<th>#{messages[' ']}</th>
				</tr>
			</thead>
			<tbody>

				<c:forEach var="_item" items="#{courseHome.instance.chapters}">
					<tr>
						<td>
							<h4 class="ui center aligned header">#{_item.name}</h4>
						</td>
						<td>#{_item.durationWithformat}</td>
						<td><h:outputText value="#{_item.createdDate}"
								converter="#{persianDateConverter}" /></td>
						<td>
							<s:fragment rendered="#{identity.loggedIn and _item.registered}">
								<span class="clickable video-tag" data-id="#{_item.id}">
									<h:outputText value="#{messages['View']}" />
								</span>
							</s:fragment> 
							<s:fragment rendered="#{!identity.loggedIn}">
								<span onclick="redirectToLogin();" style="cursor: pointer;">#{messages['Login_To_View']}</span>
							</s:fragment></td>

					</tr>
				</c:forEach>

			</tbody>
		</table>

		<script>
		jQuery(document).ready(function(){

			jQuery(".video-tag").each(function( index ) {
				jQuery(this).click(function(){
				  var chpId = jQuery(this).data("id");
				  show_video(chpId);
				});
			});

		});
		function view()
		{
			
		}
		function redirectToLogin()
		{
			window.top.location.href = window.location.origin +"#{_ctx}/member/course.seam?courseId="+#{courseId}; 
		}
		function show_video(chpId)
		{
			jQuery.fn.embed.settings.sources = {
					jedlab: {
					    name   : 'jedlab',
					    type   : 'video',
					    icon   : 'video play',
					    domain : window.location.origin,
					    url    : window.location.origin + "#{_ctx}/member/video.seam",
					    parameters: function(settings) {
					      return {
					        autohide       : !settings.showUI,
					        autoplay       : settings.autoplay,
					        color          : settings.colors || undefined,
					        hq             : settings.hd,
					        jsapi          : settings.api,
					        modestbranding : 1,
					        chapterId: chpId,
					        courseId: #{courseId}
					      };
					    }
					  }
			};

			jQuery('#videoDimmer').dimmer('show');
			jQuery('#videoEmbed').embed({
				  source      : 'jedlab'				  
				  
				});
		}

		function hide_video()
		{
			jQuery('#videoDimmer')
			  .dimmer('hide');
		}
		</script>


		<div class="ui page dimmer" id="videoDimmer">
			<div class="content">
				<div class="center">
					<div style="background-color: #000;color: #fff;height: 30px;width: 100%;z-index:99999999;" onclick="hide_video();">Close</div>
					<div class="ui embed" id="videoEmbed">
					</div>					
				</div>
			</div>
		</div>

	</s:fragment>

</ui:composition>
