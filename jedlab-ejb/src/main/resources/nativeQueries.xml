<?xml version="1.0" encoding="UTF-8"?>
<nativeQueries>
<jbpm queryName="findOpenProcessList">
 SELECT *
   FROM jbpm_variableinstance v WHERE v.process_id =?
</jbpm>
<framework queryName="deleteBuilder">
<![CDATA[
SELECT distinct on(tc.table_name) tc.table_name as "foreign_table", ccu.table_name as "main_table", ccu.column_name as "ref_column",
kcu.column_name as "foreign_column", tc.constraint_type, tc.constraint_name
FROM information_schema.constraint_column_usage ccu
JOIN information_schema.table_constraints tc ON ccu.constraint_name = tc.constraint_name
JOIN information_schema.key_column_usage kcu ON tc.constraint_name = kcu.constraint_name
WHERE ccu.table_schema='public' AND ccu.table_name= ? AND tc.constraint_type = 'FOREIGN KEY' 
]]>
</framework>
<dashboard queryName="skill">
<![CDATA[
 WITH viewed_chapter_stats AS (
         select count(*) AS total_count, member_id from member_course where is_view = true
		group by member_id
        ), code_stats AS (
         SELECT member_id,
            count(*) AS total_count
           FROM gist
          GROUP BY member_id
        ), story_stats AS (
         SELECT member_id,
            count(*) AS total_count
           FROM stories 
          GROUP BY member_id
        )
 SELECT 
   
   COALESCE(rcs.total_count, 0) + COALESCE(cs.total_count, 0) +COALESCE(ss.total_count, 0) /
    cast ( (SELECT 
            count(*) AS total_count
           FROM chapter) as numeric(5,3))  as calculated_skill,
    m.id as member_id
    
   FROM member m 
   left join viewed_chapter_stats rcs on m.id = rcs.member_id
     LEFT JOIN code_stats cs ON m.id = cs.member_id
     LEFT JOIN story_stats ss ON m.id = ss.member_id
     where m.id=?
]]>
 
</dashboard>
</nativeQueries>
